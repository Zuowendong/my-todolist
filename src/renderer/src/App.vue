<script setup>
import { computed, onMounted, ref } from 'vue'
import { Modal, Tag, Tabs, TabPane, Button, Row, Col } from 'ant-design-vue'
import { QuestionCircleOutlined, SnippetsOutlined } from '@ant-design/icons-vue'
import dayjs from 'dayjs'
import TodoList from './components/todo-list.vue'
import ShortcutKey from './components/shortcut-key.vue'

const today = computed(() => dayjs().format('YYYY-MM-DD'))

let open = ref(false)
let activeKey = ref('1')
function showModal() {
  open.value = true
  activeKey.value = '1'
}

let fileUrl = ref('')

onMounted(() => {
  fileUrl.value = window.localStorage.getItem('fileUrl') || ''
})

function changeFileStorage() {
  const { ipcRenderer } = window.electron
  ipcRenderer.invoke('dialog:changeFile').then((res) => {
    fileUrl.value = res
    window.localStorage.setItem('fileUrl', fileUrl.value)
  })
}

function openFile() {
  if (!fileUrl.value) return
  window.electronFile.setFileUrl(fileUrl.value)
}

let isFileCatalog = ref(false)
function showFileCatalog() {
  isFileCatalog.value = !isFileCatalog.value
  console.log('🔥🔥🔥🔥🔥🔥')
}
</script>

<template>
  <div class="main">
    <Row style="height: 100%">
      <Col flex="30px" class="centerCol">
        <SnippetsOutlined
          :class="['icon', isFileCatalog ? 'activeIcon' : '']"
          @click="showFileCatalog"
        />
        <QuestionCircleOutlined :class="['icon', open ? 'activeIcon' : '']" @click="showModal" />
      </Col>
      <Col v-if="isFileCatalog" flex="100px" class="centerCol">
        <div class="fileName">2023-10-07.txt</div>
        <div class="fileName">2023-10-08.txt</div>
        <div class="fileName">2023-10-09.txt</div>
        <div class="fileName">2023-10-10.txt</div>
      </Col>
      <Col flex="auto" class="contentCol">
        <header @click="handle">
          <Tag :bordered="false">{{ today }}</Tag>
          待办事项
        </header>
        <TodoList class="listBox" :fileUrl="fileUrl"></TodoList>
      </Col>
    </Row>

    <Modal v-model:open="open" title="帮助" :footer="null">
      <Tabs v-model:activeKey="activeKey">
        <TabPane key="1" tab="文件管理">
          <div class="file-manage">
            <div class="row-url">{{ fileUrl }}</div>
            <div class="row-tip">待办日志文件的默认保存位置</div>
            <div class="row-btns">
              <Button @click="changeFileStorage">更改</Button>
              <Button @click="openFile">打开文件夹</Button>
            </div>
          </div>
        </TabPane>
        <TabPane key="2" tab="快捷键">
          <ShortcutKey></ShortcutKey>
        </TabPane>
      </Tabs>
    </Modal>
  </div>
</template>

<style lang="less">
@import './assets/css/app.less';

.main {
  height: 100%;
  position: relative;
  overflow: auto;
  box-sizing: border-box;
  header {
    height: 60px;
    line-height: 60px;
  }
  .listBox {
    height: calc(100% - 60px);
  }
}

.centerCol {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 20px;
  box-shadow: 1px 0px 2px 0px #ccc;
  .icon {
    font-size: 22px;
    margin-bottom: 20px;
    color: #aaa;
  }
  .activeIcon {
    color: #333;
  }
  .fileName {
    font-size: 12px;
    line-height: 30px;
    cursor: pointer;
  }
}
.contentCol {
  box-sizing: border-box;
  padding-left: 10px;
}
.file-manage {
  height: 192px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  user-select: none;
  .row-url {
    box-sizing: border-box;
    min-width: 184px;
    height: 32px;
    border: 1px solid #ccc;
    padding: 4px 10px 4px 2px;
  }
  .row-tip {
    font-size: 12px;
    color: #666;
    padding-bottom: 24px;
  }
  .row-btns {
    width: 184px;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    column-gap: 12px;
  }
}
</style>
